# 集約保存機能 - 詳細ガイド

ReadLater for Obsidianの集約保存機能について詳しく説明します。

## 概要

集約保存機能は、複数の記事を1つのMarkdownファイルにまとめて保存する機能です。個別保存とは異なり、記事一覧をテーブル形式で表示し、詳細内容もまとめて管理できます。

## 主な特徴

### 1. テーブル形式の記事一覧
- 記事のタイトル、URL、要約、保存日時が一覧で確認可能
- Obsidianでソート・検索が容易

### 2. 階層化された記事詳細
- テーブル下部に各記事の詳細内容を配置
- 翻訳・要約内容も含めて完全な記録

### 3. 設定可能なオプション
- 集約ファイル名の指定
- テーブル要約の文字数制限
- セキュリティを考慮したファイル名検証

## 設定方法

### 1. 機能の有効化
1. Chrome拡張機能のオプションページを開く
2. 「集約保存機能」セクションを探す
3. 「集約保存を有効にする」をチェック

### 2. ファイル名の設定
```
デフォルト: ReadLater_Articles.md
カスタム例: 
- MyArticles.md
- ResearchNotes.md  
- DailyReads.md
```

### 3. テーブル設定
- **要約文字数制限**: テーブルに表示する要約の最大文字数（デフォルト: 100文字）
- 長い要約は「...」で省略されます

## ファイル構造

### 基本構造
```markdown
# ReadLater Articles

| タイトル | URL | 要約 | 日時 |
|---------|-----|------|------|
| 記事1 | URL1 | 要約1 | 日付1 |
| 記事2 | URL2 | 要約2 | 日付2 |

## 記事詳細

### 記事1のタイトル
**元記事**: [タイトル](URL)
**保存日**: 日付

## 要約
[AI生成要約]

## 翻訳済み内容
[翻訳された本文]

### 記事2のタイトル
...

---
*Generated by ReadLater for Obsidian*
```

### 翻訳記事の扱い
翻訳された記事は以下の形式で保存されます：

```markdown
## 翻訳済み内容
[翻訳済みテキスト]

<details>
<summary>原文を表示</summary>

[原文テキスト]

</details>
```

## 技術仕様

### ファイルサイズ制限
- 最大ファイルサイズ: 10MB
- 制限を超える場合はエラーが発生し、個別保存が提案されます

### セキュリティ機能
- ファイル名の不正文字チェック
- パスインジェクション攻撃の防止
- HTMLエスケープ処理

### エラーハンドリング
- ファイル読み込みエラーの自動復旧
- 破損ファイルの検出と再作成
- リトライ機能による信頼性向上

## 使用例

### 日常的な情報収集
1. ニュース記事、ブログ記事を次々と保存
2. 1日の終わりに集約ファイルで一覧確認
3. 重要な記事をObsidianでリンクやタグ付け

### 研究・調査活動
1. 特定のトピックに関する記事を継続的に収集
2. テーブルで全体の傾向を把握
3. 詳細セクションで深い内容を参照

### 学習記録
1. 技術記事、チュートリアルを体系的に保存
2. 進捗状況をテーブルで管理
3. 必要時に詳細内容を参照

## トラブルシューティング

### よくある問題

#### 1. 集約保存が実行されない
- 集約保存機能が有効になっているか確認
- ファイル名に不正な文字が含まれていないか確認

#### 2. 既存ファイルに追加されない
- ファイル形式が正しいMarkdownテーブルか確認
- ファイルが破損していないか確認（削除して再作成を試行）

#### 3. テーブル表示が崩れる
- 記事タイトルや要約に特殊文字（`|`など）が含まれている場合、自動的にエスケープされます
- Obsidianでファイルをリロードしてみてください

#### 4. パフォーマンスの問題
- ファイルサイズが大きくなった場合は新しい集約ファイルの作成を検討
- 月別、週別でファイル分割することを推奨

### エラーメッセージ対応

#### "集約ファイルの操作に失敗しました"
1. ファイルの読み書き権限を確認
2. 集約ファイルを削除して再作成
3. 個別保存モードに一時的に切り替え

#### "ファイルサイズが制限を超えています"
1. 新しい集約ファイルを作成
2. 古い記事を別ファイルに移動
3. 要約文字数制限を短くして調整

## パフォーマンス最適化

### 推奨設定
- **ファイルサイズ**: 5MB以下を推奨
- **記事数**: 100記事以下を推奨  
- **要約文字数**: 50-100文字を推奨

### 分割戦略
大量の記事を扱う場合の分割方法：

1. **時間別分割**
   - `ReadLater_2025_01.md`
   - `ReadLater_2025_02.md`

2. **トピック別分割**
   - `Tech_Articles.md`
   - `News_Articles.md`

3. **言語別分割**
   - `Japanese_Articles.md`
   - `English_Articles.md`

## 開発者向け情報

### API仕様
集約保存機能は以下のクラスで実装されています：

- `AggregatedFileManager`: ファイル操作管理
- `ArticleTableManager`: テーブル生成・操作
- `AggregatedMarkdownGenerator`: Markdown生成

### テスト
- 単体テスト: `tests/lib/`
- 統合テスト: `tests/integration/aggregated-save.test.js`
- 手動テスト: `tests/manual/`

### 設定ファイル
集約保存の設定はChrome Storage APIで管理：

```javascript
{
  aggregatedSaving: {
    enabled: boolean,
    fileName: string,
    maxTableSummaryLength: number
  }
}
```