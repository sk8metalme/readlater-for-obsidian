<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadLater for Obsidian - 設定</title>
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>📖 ReadLater for Obsidian</h1>
            <p class="subtitle">Chrome拡張機能の設定</p>
        </header>

        <main class="main-content">
            <!-- 設定保存状況の表示 -->
            <div id="status-message" class="status-message" style="display: none;"></div>

            <!-- 基本設定セクション -->
            <section class="settings-section">
                <h2>🔧 基本設定</h2>
                
                <div class="setting-group">
                    <label for="obsidian-path" class="setting-label">
                        📁 Obsidian保存先フォルダ
                        <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="obsidian-path" 
                        class="setting-input" 
                        placeholder="例: ReadLater または Downloads/ReadLater"
                    >
                    <div class="setting-help">
                        記事を保存するフォルダを指定します。<br>
                        - 例1: <code>ReadLater</code>（ダウンロード内のサブフォルダ）<br>
                        - 例2: <code>/Users/あなたのユーザー名/Library/Mobile Documents/iCloud~md~obsidian/Documents</code>（絶対パス）<br>
                        絶対パスを指定した場合はネイティブホスト経由で直接保存されます。
                    </div>
                </div>
            </section>

            <!-- Claude CLI設定セクション -->
            <section class="settings-section">
                <h2>🤖 Claude CLI設定</h2>
                
                <div class="setting-group">
                    <div class="info-box">
                        <h4>📋 Claude CLIについて</h4>
                        <p>ReadLater for Obsidianは、ローカルにインストールされたClaude CLIを使用します。APIキーは不要です。</p>
                        <p><strong>必要な作業:</strong> Claude CLIをローカルにインストールしてください。</p>
                        <a href="https://docs.anthropic.com/ja/docs/claude-code/cli-reference" target="_blank" rel="noopener" class="install-link">
                            📥 Claude CLIインストールガイド
                        </a>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label">🔍 Claude CLI状態</label>
                    <div id="claude-status" class="status-indicator">
                        <span class="status-icon">⏳</span>
                        <span class="status-text">確認中...</span>
                    </div>
                    <div class="setting-help">
                        Claude CLIの利用可能性を自動的に検出します
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label">🌐 機能の有効/無効</label>
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="translation-enabled" checked>
                            <span class="checkmark"></span>
                            タイトル翻訳機能を有効にする
                        </label>
                        <div class="setting-help-small">
                            外国語の記事タイトルを日本語に翻訳します（本文は翻訳されません）
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="summary-enabled" checked>
                            <span class="checkmark"></span>
                            要約機能を有効にする
                        </label>
                        <div class="setting-help-small">
                            記事の要約を自動生成します
                        </div>
                    </div>
                </div>
            </section>

            <!-- 記事保存設定セクション -->
            <section class="settings-section">
                <h2>📄 記事保存設定</h2>
                
                <div class="setting-group">
                    <label class="setting-label">💾 保存方式</label>
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="aggregated-saving-enabled">
                            <span class="checkmark"></span>
                            集約保存を有効にする
                        </label>
                        <div class="setting-help-small">
                            複数の記事を1つのMarkdownファイルに集約して保存します。無効の場合は記事ごとに個別ファイルで保存されます。
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label for="aggregated-file-name" class="setting-label">
                        📋 集約ファイル名
                        <span class="conditional-required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="aggregated-file-name" 
                        class="setting-input" 
                        placeholder="例: ReadLater_Articles.md"
                        disabled
                    >
                    <div class="setting-help">
                        集約保存時に使用するMarkdownファイル名を指定します。<br>
                        拡張子(.md)は自動的に追加されます。
                    </div>
                </div>
            </section>

            <!-- 詳細設定セクション -->
            <section class="settings-section">
                <h2>⚙️ 詳細設定</h2>
                
                <div class="setting-group">
                    <label for="target-language" class="setting-label">🈁 翻訳先言語</label>
                    <select id="target-language" class="setting-select">
                        <option value="ja">日本語</option>
                        <option value="en">English</option>
                        <option value="zh">中文</option>
                        <option value="ko">한국어</option>
                    </select>
                    <div class="setting-help">
                        記事を翻訳する際の対象言語を選択してください
                    </div>
                </div>

                <div class="setting-group">
                    <label for="file-naming" class="setting-label">📄 ファイル名形式</label>
                    <select id="file-naming" class="setting-select">
                        <option value="date-title">日付_タイトル形式</option>
                        <option value="title-date">タイトル_日付形式</option>
                        <option value="title-only">タイトルのみ</option>
                    </select>
                    <div class="setting-help">
                        個別保存時のMarkdownファイルの命名規則を選択してください
                    </div>
                </div>
            </section>

            <!-- 接続テストセクション -->
            <section class="settings-section">
                <h2>🔍 接続テスト</h2>
                
                <div class="test-group">
                    <button id="test-claude-connection" class="test-btn">
                        🤖 Claude CLI動作テスト
                    </button>
                    <div id="claude-test-result" class="test-result"></div>
                </div>

                <div class="test-group">
                    <button id="test-file-save" class="test-btn">
                        💾 ファイル保存テスト
                    </button>
                    <div id="file-test-result" class="test-result"></div>
                </div>
            </section>

            <!-- 使用方法セクション -->
            <section class="settings-section">
                <h2>📖 使用方法</h2>
                
                <div class="usage-content">
                    <ol class="usage-steps">
                        <li>保存したい記事のページで<strong>右クリック</strong></li>
                        <li><strong>「📖 後で読む（ReadLater）」</strong>を選択</li>
                        <li>自動的に記事抽出→翻訳→要約→保存が実行されます</li>
                        <li>Obsidianの指定フォルダにMarkdownファイルが保存されます</li>
                    </ol>
                    
                    <div class="feature-list">
                        <h4>主な機能:</h4>
                        <ul>
                            <li>🔍 記事の自動抽出（タイトル、本文、メタデータ）</li>
                            <li>🌐 タイトル翻訳機能（外国語タイトルを日本語に翻訳）</li>
                            <li>📝 AI要約による主要ポイントの抽出</li>
                            <li>📁 Obsidian対応Markdown形式での保存</li>
                            <li>⚡ ワンクリックでの簡単保存</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="button-group">
                <button id="save-settings" class="save-btn">💾 設定を保存</button>
                <button id="reset-settings" class="reset-btn">🔄 デフォルトに戻す</button>
            </div>
            
            <div class="footer-info">
                <p>ReadLater for Obsidian v1.0.0</p>
                <p>問題の報告: <a href="https://github.com/yourusername/readlater-for-obsidian/issues" target="_blank">GitHub Issues</a></p>
            </div>
        </footer>
    </div>

    <script src="options.js"></script>
</body>
</html>
